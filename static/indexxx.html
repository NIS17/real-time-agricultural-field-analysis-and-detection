<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Agri-AI Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-2xl shadow-xl p-8 m-4 max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">ðŸŒ¾ Agri-AI Suite</h1>

        <!-- Model Selection Switch -->
        <div class="mb-6">
            <label class="font-semibold text-gray-700 block text-center">Choose a Tool:</label>
            <div class="mt-2 flex justify-center space-x-4 border-b pb-4">
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" id="disease_model" name="model_choice" value="disease" onclick="toggleUI()" checked>
                    <span>Plant Disease</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" id="soil_model" name="model_choice" value="soil" onclick="toggleUI()">
                    <span>Soil Type</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer">
                    <input type="radio" id="moisture_model" name="model_choice" value="moisture" onclick="toggleUI()">
                    <span>Soil Moisture</span>
                </label>
            </div>
        </div>

        <!-- Image Uploader (for Disease and Soil Type) -->
        <div id="image_interface">
            <input type="file" id="fileInput" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
            <img id="preview" style="max-width: 300px; max-height: 300px; margin: 20px auto; display: none;" class="rounded-lg shadow-md">
        </div>

        <!-- Numerical Input Form (for Soil Moisture) -->
        <div id="moisture_interface" style="display: none;">
            <p class="text-center text-sm text-gray-500 mb-4">Enter the following sensor and weather data:</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <input type="number" id="month" placeholder="Month (1-12)" class="p-2 border rounded">
                <input type="number" id="day" placeholder="Day (1-31)" class="p-2 border rounded">
                <input type="number" id="avg_temp" placeholder="Avg Temp (Â°C)" step="any" class="p-2 border rounded">
                <input type="number" id="avg_wind" placeholder="Avg Wind (m/s)" step="any" class="p-2 border rounded">
                <input type="number" id="avg_ws" placeholder="Avg Wind Speed (km/h)" step="any" class="p-2 border rounded">
                <input type="number" id="avg_sol_rad" placeholder="Avg Solar Rad" step="any" class="p-2 border rounded">
                <input type="number" id="s_1_t" placeholder="Sensor 1 Temp" step="any" class="p-2 border rounded">
                <input type="number" id="s_2_t" placeholder="Sensor 2 Temp" step="any" class="p-2 border rounded">
                <input type="number" id="s_3_t" placeholder="Sensor 3 Temp" step="any" class="p-2 border rounded">
                <input type="number" id="s_4_t" placeholder="Sensor 4 Temp" step="any" class="p-2 border rounded">
            </div>
        </div>

        <button onclick="getPrediction()" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition">Get Prediction</button>

        <div id="output" class="mt-6 text-center min-h-[50px] p-4 bg-gray-50 rounded-lg">Waiting for input...</div>
    </div>

    <script>
        const imageInterface = document.getElementById('image_interface');
        const moistureInterface = document.getElementById('moisture_interface');
        const outputDiv = document.getElementById('output');
        const previewImg = document.getElementById('preview');

        function toggleUI() {
            const selectedModel = document.querySelector('input[name="model_choice"]:checked').value;
            if (selectedModel === 'moisture') {
                imageInterface.style.display = 'none';
                moistureInterface.style.display = 'block';
            } else {
                imageInterface.style.display = 'block';
                moistureInterface.style.display = 'none';
            }
            outputDiv.innerText = 'Waiting for input...';
            previewImg.style.display = 'none';
        }

        async function getPrediction() {
            const selectedModel = document.querySelector('input[name="model_choice"]:checked').value;
            outputDiv.innerText = 'Processing...';

            let endpoint = '';
            let options = {};

            if (selectedModel === 'moisture') {
                endpoint = '/predict/moisture';

                // --- THE FIX: Use parseInt for integers and parseFloat for floats ---
                const inputData = {
                    Month: parseInt(document.getElementById('month').value, 10), // Use parseInt
                    Day: parseInt(document.getElementById('day').value, 10),     // Use parseInt
                    avg_temp: parseFloat(document.getElementById('avg_temp').value),
                    avg_wind: parseFloat(document.getElementById('avg_wind').value),
                    avg_ws: parseFloat(document.getElementById('avg_ws').value),
                    avg_sol_rad: parseFloat(document.getElementById('avg_sol_rad').value),
                    s_1_t: parseFloat(document.getElementById('s_1_t').value),
                    s_2_t: parseFloat(document.getElementById('s_2_t').value),
                    s_3_t: parseFloat(document.getElementById('s_3_t').value),
                    s_4_t: parseFloat(document.getElementById('s_4_t').value),
                };

                if (Object.values(inputData).some(v => isNaN(v))) {
                    outputDiv.innerText = 'Please fill in all 10 input fields with valid numbers.';
                    return;
                }
                options = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputData)
                };
            } else { // Handle image models
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];
                if (!file) {
                    outputDiv.innerText = 'Please select an image file.';
                    return;
                }
                previewImg.src = URL.createObjectURL(file);
                previewImg.style.display = 'block';
                const formData = new FormData();
                formData.append('file', file);
                endpoint = selectedModel === 'disease' ? '/predict/disease' : '/predict/soil';
                options = { method: 'POST', body: formData };
            }

            try {
                const response = await fetch(endpoint, options);
                if (!response.ok) throw new Error(`Server error: ${response.status}`);
                const data = await response.json();

                if (data.predicted_moisture !== undefined) {
                    outputDiv.innerHTML = `<h2 class="text-xl font-semibold">Predicted Moisture: <span class="text-blue-600">${data.predicted_moisture.toFixed(3)}</span></h2>`;
                } else {
                    let predictionText = data.prediction.replace(/_/g, ' ');
                    outputDiv.innerHTML = `
                        <h2 class="text-xl font-semibold">Prediction: <span class="text-green-600">${predictionText}</span></h2>
                        <p class="text-gray-600">Confidence: ${(data.confidence * 100).toFixed(2)}%</p>`;
                }
            } catch (error) {
                outputDiv.innerText = `Error: ${error.message}`;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>
